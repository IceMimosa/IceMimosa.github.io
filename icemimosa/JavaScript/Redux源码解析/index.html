
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="baidu_union_verify" content="d1952c66cf48912e21c18c7c581f382a">
  <meta name="360-site-verification" content="67fbcc5a67f4c65c057315b28fa0b2c8">
<meta name="google-site-verification" content="2GzxQ0VtXwTSUdmGm6DzcmhTzM_I9QmzCb_pzpMzD88">
  
    <title>Reduxæºç è§£æ | Ice ã® Mimosa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="IceMimosa">
    
    <meta name="description" content="[TOC]
Reduxæºç è§£æå…³äºReduxå‡ºç°çš„èƒŒæ™¯å’Œä½¿ç”¨, è¿™é‡Œå°±ä¸åšé˜è¿°äº†, å¯ä»¥å‚è€ƒreduxçš„æºç è§£æ, æˆ‘è¿™é‡Œç›´æ¥ä¸Šç®€å•ä»£ç ã€‚
123456789101112131415161718192021// 1. å®šä¹‰ action å’Œ reducerconst action = &amp;#123;	">
    
    
    
    
    <link rel="alternate" href="atom.xml" title="Ice ã® Mimosa" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon_mine.ico">
    
    
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/jquery-icemi-scroll2top.css">
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            var _bdId ='1cb536fd996cddc96154515a1ed1d72d';
             hm.src = "//hm.baidu.com/hm.js?" + _bdId;
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
        })();
    </script>
     
</head>
</html>
  <body>
    <header>
      <div id="banner">
		

			<div id="erer" class="erer" style="">
				<!-- <img id="i22" src="/img/22.png" width=200 height=230></img> -->
				<!-- <img id="i22" src="http://ice-img.dreamylost.cn/patamon-22.png" width=200 height=230></img> -->
			</div>

			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Ice ã® Mimosa">Ice ã® Mimosa</a></h1>
				<a class="blog-motto">æ²¡æœ‰æœªæ¥çš„æœªæ¥ä¸æ˜¯æˆ‘æƒ³è¦çš„æœªæ¥</a>
			</div>

			<div id="sansan" class="sansan" style="">
				<!-- <img src="/img/33.png" width=200 height=230></img> -->
				<!-- <img src="http://ice-img.dreamylost.cn/patamon-33.png" width=200 height=230></img> -->
			</div> 

			<div class="navbar"><a class="navbutton navmobile" href="#" title="èœå•">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">ä¸»é¡µ</a></li>
					
						<li><a href="/archives">å½’æ¡£</a></li>
					
						<li><a href="/categories">åˆ†ç±»</a></li>
					
					<li>
					
                                            <form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
                                            <label>Search</label>
                                        <input name="s" type="hidden" value="8360843150509117428"><input type="text" name="q" size="30" placeholder="æœç´¢"><br>
					
					</form></li>
				</ul>
			</ul></nav>
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope="" itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/icemimosa/JavaScript/Reduxæºç è§£æ/" title="Reduxæºç è§£æ" itemprop="url">Reduxæºç è§£æ</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://www.patamon.me" title="IceMimosa">IceMimosa</a>
    </p>
  <p class="article-time">
    <time datetime="2018-12-07T06:30:16.000Z" itemprop="datePublished">2018-12-07</time>
    æ›´æ–°æ—¥æœŸ:<time datetime="2023-02-15T14:15:04.571Z" itemprop="dateModified">2023-02-15</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">æ–‡ç« ç›®å½•</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Reduxæºç è§£æ"><span class="toc-text">Reduxæºç è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-index-js"><span class="toc-text">1. index.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-createStore"><span class="toc-text">2. createStore</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-store-subscribe"><span class="toc-text">2.1 store.subscribe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-store-dispatch"><span class="toc-text">2.2 store.dispatch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-store-getState"><span class="toc-text">2.3 store.getState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-store-replaceReducer"><span class="toc-text">2.4 store.replaceReducer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-combineReducers"><span class="toc-text">3. combineReducers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-applyMiddleware"><span class="toc-text">4. applyMiddleware</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-æ€»ç»“"><span class="toc-text">5. æ€»ç»“</span></a></li></ol></li></ol>
		</div>
		
		<p>[TOC]</p>
<h1 id="Reduxæºç è§£æ"><a href="#Reduxæºç è§£æ" class="headerlink" title="Reduxæºç è§£æ"></a>Reduxæºç è§£æ</h1><p>å…³äºReduxå‡ºç°çš„èƒŒæ™¯å’Œä½¿ç”¨, è¿™é‡Œå°±ä¸åšé˜è¿°äº†, å¯ä»¥å‚è€ƒ<a href="https://www.cnblogs.com/createGod/p/9051166.html#commentform" target="_blank" rel="noopener">reduxçš„æºç è§£æ</a>, æˆ‘è¿™é‡Œç›´æ¥ä¸Šç®€å•ä»£ç ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å®šä¹‰ action å’Œ reducer</span></span><br><span class="line"><span class="keyword">const</span> action = &#123;</span><br><span class="line">	type: <span class="string">"hello"</span>,</span><br><span class="line">	payload: <span class="string">"hello"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> reducer = &#123;</span><br><span class="line">	hello: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">  		<span class="keyword">return</span> &#123; <span class="attr">data</span>: <span class="string">`<span class="subst">$&#123;action.payload&#125;</span> world`</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2. åˆ›å»º store</span></span><br><span class="line"><span class="keyword">const</span> store = Redux.createStore(Redux.combineReducers(reducer))</span><br><span class="line"><span class="comment">// 3. ç›‘å¬äº‹ä»¶</span></span><br><span class="line"><span class="keyword">const</span> unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"hello subscriber"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. dispatch action</span></span><br><span class="line">store.dispatch(action)</span><br><span class="line"><span class="built_in">console</span>.log(store.getState().hello); <span class="comment">//&gt; hello world</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. å–æ¶ˆç›‘å¬</span></span><br><span class="line">unsubscribe()</span><br></pre></td></tr></table></figure>
<h2 id="1-index-js"><a href="#1-index-js" class="headerlink" title="1. index.js"></a>1. index.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is a dummy function to check if the function name has been altered by minification.</span></span><br><span class="line"><span class="comment"> * If the function has been minified and NODE_ENV !== 'production', warn the user.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦å‹ç¼©, å¦‚æœåœ¨éproductionç¯å¢ƒä½¿ç”¨äº†å‹ç¼©æ–‡ä»¶, å°±ä¼šæŠ¥å¦‚ä¸‹warning</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isCrushed</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp;</span><br><span class="line">  <span class="keyword">typeof</span> isCrushed.name === <span class="string">'string'</span> &amp;&amp;</span><br><span class="line">  isCrushed.name !== <span class="string">'isCrushed'</span></span><br><span class="line">) &#123;</span><br><span class="line">  warning(</span><br><span class="line">    <span class="string">'You are currently using minified code outside of NODE_ENV === "production". '</span> +</span><br><span class="line">      <span class="string">'This means that you are running a slower development build of Redux. '</span> +</span><br><span class="line">      <span class="string">'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify '</span> +</span><br><span class="line">      <span class="string">'or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) '</span> +</span><br><span class="line">      <span class="string">'to ensure you have the correct code for your production build.'</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æš´éœ²äº†çš„API, å¿½ç•¥æœ€åä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  createStore,</span><br><span class="line">  combineReducers,</span><br><span class="line">  bindActionCreators,</span><br><span class="line">  applyMiddleware,</span><br><span class="line">  compose,</span><br><span class="line">  __DO_NOT_USE__ActionTypes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-createStore"><a href="#2-createStore" class="headerlink" title="2. createStore"></a>2. createStore</h2><p>å…ˆä¸è¯´<code>combineReducers</code>, å…ˆçŸ¥é“å®ƒè¿”å›çš„æ˜¯ä¸ª<code>function</code>, å…¥å‚æ˜¯<code>(state, action)</code>å³å¯.<br>å…ˆçœ‹ createStore, å†…éƒ¨ä¸€å †æ ¡éªŒã€åˆå§‹åŒ–å’Œå‡½æ•°å®šä¹‰, ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * reducer: (state, action) =&gt; Any</span></span><br><span class="line"><span class="comment"> * preloadedState: é»˜è®¤çš„state</span></span><br><span class="line"><span class="comment"> * enhancer: å¢å¼ºæ–¹æ³•, æ¯”å¦‚å†…ç½®çš„ applyMiddleware</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * // å…ˆæœ‰ä¸ªå°è±¡, å‡è®¾ preloadedState å’Œ enhancer æˆ‘éƒ½æ²¡æœ‰ä¼ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1. å„ç§å‚æ•°æ ¡éªŒ</span></span><br><span class="line">  <span class="comment">// &gt; preloadedState åœ¨ enhancer å­˜åœ¨çš„æ—¶å€™ä¸èƒ½ä¸ºfunction, æ­¤æ—¶ preloadedState åªèƒ½æ˜¯ä¸ª object</span></span><br><span class="line">  <span class="comment">// &gt; å› ä¸ºreduxä¼šè®¤ä¸ºä½ ä¼ äº†å¤šä¸ªenhancer, æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    (<span class="keyword">typeof</span> preloadedState === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> enhancer === <span class="string">'function'</span>) ||</span><br><span class="line">    (<span class="keyword">typeof</span> enhancer === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">arguments</span>[<span class="number">3</span>] === <span class="string">'function'</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'It looks like you are passing several store enhancers to '</span> +</span><br><span class="line">        <span class="string">'createStore(). This is not supported. Instead, compose them '</span> +</span><br><span class="line">        <span class="string">'together to a single function'</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &gt; è¿™é‡Œå¯¹åº”ä¸Šé¢, å¦‚æœ preloadedState æ˜¯function, ä¸” enhancer æ²¡æœ‰ä¼ å…¥</span></span><br><span class="line">  <span class="comment">// &gt; å°† preloadedState èµ‹å€¼ç»™ enhancer</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> preloadedState === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> enhancer === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    enhancer = preloadedState</span><br><span class="line">    preloadedState = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &gt; åŒç†, enhancer å¿…é¡»æ˜¯ä¸ª function</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// &gt; è¿™é‡Œç¨å¾®å¤æ‚, åç»­ä¼šè¯´</span></span><br><span class="line">    <span class="comment">// &gt; ä¸Šé¢è¯´äº†, preloadedStateå’Œenhancerå‡è®¾éƒ½æ²¡ä¼ , ä»£ç èµ°ä¸åˆ°è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// &gt; reducer å¿…é¡»æ˜¯ä¸ª function</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the reducer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. åˆå§‹åŒ–å„ç§å‚æ•°</span></span><br><span class="line">  <span class="keyword">let</span> currentReducer = reducer           <span class="comment">// å½“å‰reducerå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">let</span> currentState = preloadedState      <span class="comment">// å½“å‰stateå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">let</span> currentListeners = []              <span class="comment">// å½“å‰çš„listeners, è°ƒç”¨subscribeä¼šç”¨åˆ°</span></span><br><span class="line">  <span class="keyword">let</span> nextListeners = currentListeners   <span class="comment">// currentListeners çš„é•œåƒ, ç±»ä¼¼é˜²æ­¢å¤šçº¿ç¨‹æ“ä½œçš„æ„Ÿè§‰</span></span><br><span class="line">  <span class="keyword">let</span> isDispatching = <span class="literal">false</span>              <span class="comment">// æ˜¯å¦æ­£åœ¨ dispatch</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ------------------------------------------------------</span></span><br><span class="line">  <span class="comment">// ä¸€å †å‡½æ•°å®šä¹‰(dispatch, subscribe, getStateç­‰), ä¸ä¸Šé¢çš„å˜é‡æ„æˆé—­åŒ…</span></span><br><span class="line">  <span class="comment">// ------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// When a store is created, an "INIT" action is dispatched so that every</span></span><br><span class="line">  <span class="comment">// reducer returns their initial state. This effectively populates</span></span><br><span class="line">  <span class="comment">// the initial state tree.</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è¿™é‡Œæœ‰ç‚¹æ„æ€, å‘å‡ºä¸€ä¸ªINITçš„action, ä¸€èˆ¬reducerå¤„ç†çš„æ—¶å€™, éƒ½ä¼šè¿”å›ä¸€ä¸ªé»˜è®¤çš„ &#123; reducer: state &#125;</span></span><br><span class="line">  <span class="comment">// è¿™é‡Œçš„æ„æ€å°±æ˜¯æŠŠæ‰€æœ‰reduceræ‰§è¡Œäº†ä¸€é, ç„¶ååˆå§‹åŒ–äº†å…¨å±€çš„state tree</span></span><br><span class="line">  dispatch(&#123; <span class="attr">type</span>: ActionTypes.INIT &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›storeçš„API</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dispatch,</span><br><span class="line">    subscribe,</span><br><span class="line">    getState,</span><br><span class="line">    replaceReducer,</span><br><span class="line">    [$$observable]: observable</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-1-store-subscribe"><a href="#2-1-store-subscribe" class="headerlink" title="2.1 store.subscribe"></a>2.1 store.subscribe</h3><p>ç°åœ¨æˆ‘ä»¬çœ‹çœ‹subscribeæ˜¯æ€ä¹ˆæ³¨å†Œç»™storeçš„, æƒ³æƒ³ä¹ŸçŸ¥é“æ˜¯æ”¾åœ¨äº†<code>currentListeners</code>å¯¹è±¡ä¸­ğŸ˜.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * listener: () =&gt; Unit, æ˜¯ä¸ªç®€å•çš„å‡½æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1. å„ç§æ ¡éªŒ</span></span><br><span class="line">  <span class="comment">// &gt; listener å¿…é¡»æ˜¯ä¸ªå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the listener to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// &gt; å¦‚æœå½“å‰æ­£åœ¨dispatch, æŠ›å‡ºå¼‚å¸¸, æ˜¯ä¸å…è®¸subscribeæ“ä½œçš„</span></span><br><span class="line">  <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'You may not call store.subscribe() while the reducer is executing. '</span> +</span><br><span class="line">        <span class="string">'If you would like to be notified after the store has been updated, subscribe from a '</span> +</span><br><span class="line">        <span class="string">'component and invoke store.getState() in the callback to access the latest state. '</span> +</span><br><span class="line">        <span class="string">'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.'</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ‡è®°å·²ç»è®¢é˜…, ä¸è¿”å›å€¼å½¢æˆé—­åŒ…</span></span><br><span class="line">  <span class="keyword">let</span> isSubscribed = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * // å‡½æ•°æ¯”è¾ƒç®€å•, å°±æ˜¯åšäº†ä¸‹æ‹·è´</span></span><br><span class="line"><span class="comment">   * // è®°ä½å®ƒ, å› ä¸ºæ¯æ¬¡æ“ä½œlistenersçš„æ—¶å€™éƒ½ä¼šè°ƒç”¨</span></span><br><span class="line"><span class="comment">   * function ensureCanMutateNextListeners() &#123;</span></span><br><span class="line"><span class="comment">   *   if (nextListeners === currentListeners) &#123;</span></span><br><span class="line"><span class="comment">   *     nextListeners = currentListeners.slice()</span></span><br><span class="line"><span class="comment">   *   &#125;</span></span><br><span class="line"><span class="comment">   * &#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  ensureCanMutateNextListeners()</span><br><span class="line">  nextListeners.push(listener)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ ¡éªŒisSubscribedçš„å€¼, ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯true, è°ƒç”¨åå˜æˆfalse</span></span><br><span class="line">    <span class="comment">// é˜²æ­¢å¤šæ¬¡è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (!isSubscribed) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰æ­£åœ¨dispatch, æŠ›å‡ºå¼‚å¸¸, æ˜¯ä¸å…è®¸subscribeæ“ä½œçš„</span></span><br><span class="line">    <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">'You may not unsubscribe from a store listener while the reducer is executing. '</span> +</span><br><span class="line">          <span class="string">'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.'</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç½®ä¸ºfalse, é˜²æ­¢å¤šæ¬¡è°ƒç”¨</span></span><br><span class="line">    isSubscribed = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»listenersä¸­ç§»é™¤è¯¥å‡½æ•°</span></span><br><span class="line">    ensureCanMutateNextListeners()</span><br><span class="line">    <span class="keyword">const</span> index = nextListeners.indexOf(listener)</span><br><span class="line">    nextListeners.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-store-dispatch"><a href="#2-2-store-dispatch" class="headerlink" title="2.2 store.dispatch"></a>2.2 store.dispatch</h3><p>å¼€å§‹åˆ†ædispatch, é‡å¤´æˆğŸ‘», ä¸è¿‡ä»£ç å€’æ˜¯ä¸å¤šã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">nction dispatch(action) &#123;</span><br><span class="line">  <span class="comment">// 1. å„ç§æ ¡éªŒ</span></span><br><span class="line">  <span class="comment">// &gt; åˆ¤æ–­æ˜¯å¦æ˜¯ä¸ªç®€å•å¯¹è±¡, å¦‚æœå«æœ‰å¾ˆæ·±çš„åŸå‹é“¾, ä¼šè¿”å›false. å¯ä»¥çœ‹ä¸‹isPlainObjectçš„å®ç°</span></span><br><span class="line">  <span class="keyword">if</span> (!isPlainObject(action)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'Actions must be plain objects. '</span> +</span><br><span class="line">        <span class="string">'Use custom middleware for async actions.'</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// &gt; actionå¿…é¡»æœ‰typeçš„å®šä¹‰</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> action.type === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'Actions may not have an undefined "type" property. '</span> +</span><br><span class="line">        <span class="string">'Have you misspelled a constant?'</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// &gt; å¦‚æœæ­£åœ¨dispatch, æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">  <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Reducers may not dispatch actions.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. è°ƒç”¨reducer</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    isDispatching = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªè¿”å›çš„stateå·²ç»æ˜¯åˆå¹¶è¿‡çš„äº†, æ˜¯reduxçš„state tree. å…ˆä¸è¦åœ¨æ„currentReduceré•¿ä»€ä¹ˆæ ·å­</span></span><br><span class="line">    currentState = currentReducer(currentState, action)</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123; <span class="comment">// finally, è°ƒç”¨ç»“æŸ</span></span><br><span class="line">    isDispatching = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. è§¦å‘æ‰€æœ‰çš„ listener, æ²¡å•¥æ¯›ç—…</span></span><br><span class="line">  <span class="keyword">const</span> listeners = (currentListeners = nextListeners)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> listener = listeners[i]</span><br><span class="line">    listener()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. è¿”å› action</span></span><br><span class="line">  <span class="keyword">return</span> action</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-store-getState"><a href="#2-3-store-getState" class="headerlink" title="2.3 store.getState"></a>2.3 store.getState</h3><p>è·å–Reduxçš„ <code>state tree</code>, è¿™â€¦., æ²¡å•¥å¥½è¯´çš„ã€‚æ³¨æ„<code>stateä¸­çš„key</code>å°±æ˜¯<code>reducerçš„key</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'You may not call store.getState() while the reducer is executing. '</span> +</span><br><span class="line">        <span class="string">'The reducer has already received the state as an argument. '</span> +</span><br><span class="line">        <span class="string">'Pass it down from the top reducer instead of reading it from the store.'</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> currentState</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-store-replaceReducer"><a href="#2-4-store-replaceReducer" class="headerlink" title="2.4 store.replaceReducer"></a>2.4 store.replaceReducer</h3><p>æ¯”è¾ƒç®€å•, è‡ªè¡Œçœ‹ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceReducer</span>(<span class="params">nextReducer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> nextReducer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the nextReducer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  currentReducer = nextReducer</span><br><span class="line">  dispatch(&#123; <span class="attr">type</span>: ActionTypes.REPLACE &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-combineReducers"><a href="#3-combineReducers" class="headerlink" title="3. combineReducers"></a>3. combineReducers</h2><p>å„ç§æ ¡éªŒä»£ç æ¯”è¾ƒå¤š, å¤§ä¼™è€å¿ƒçœ‹ä¸‹ã€‚â­ï¸</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * reducers: &#123; key1: reducer1, key2: reducer2, ... &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1. æ ¡éªŒreducersçš„ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> reducerKeys = <span class="built_in">Object</span>.keys(reducers)</span><br><span class="line">  <span class="keyword">const</span> finalReducers = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = reducerKeys[i]</span><br><span class="line">    <span class="comment">// å¦‚æœreduceræ˜¯undefined, æŠ›å‡ºè­¦å‘Š</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        warning(<span class="string">`No reducer provided for key "<span class="subst">$&#123;key&#125;</span>"`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœreducerä¸æ˜¯function, åˆ™å¿½ç•¥. éƒ½æ”¾åˆ°å˜é‡finalReducersä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'function'</span>) &#123;</span><br><span class="line">      finalReducers[key] = reducers[key]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> finalReducerKeys = <span class="built_in">Object</span>.keys(finalReducers)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. åé¢æ¯”è¾ƒstateå’Œæ‰€æœ‰reducerä¸­çš„key, å°†å¼‚å¸¸çš„keyå–å‡ºæ¥</span></span><br><span class="line">  <span class="keyword">let</span> unexpectedKeyCache</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    unexpectedKeyCache = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 3. æ ¡éªŒreducerè¿”å›çš„é»˜è®¤stateå€¼, å¦‚æœæ˜¯undefined, æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">  <span class="keyword">let</span> shapeAssertionError</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™å‡ ä¸ªæ— å…³ç´§è¦çš„æ–¹æ³•å°±ä¸è¯´, çœ‹ä¸‹å°±çŸ¥é“äº†</span></span><br><span class="line">    assertReducerShape(finalReducers)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    shapeAssertionError = e</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 4. è¿”å›æ–¹æ³•, åœ¨dispatchçš„ä¼šè°ƒç”¨, è¿™é‡Œå°±ä¸²èµ·æ¥äº†</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1. å„ç§æ ¡éªŒ</span></span><br><span class="line">    <span class="comment">// &gt; å¦‚æœä¹‹å‰å­˜åœ¨å¼‚å¸¸, æŠ›å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (shapeAssertionError) &#123;</span><br><span class="line">      <span class="keyword">throw</span> shapeAssertionError</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// &gt; å¤„ç†unexpectedKeyCache, æŠ›å‡ºè­¦å‘Š</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="comment">// è¿™å‡ ä¸ªæ— å…³ç´§è¦çš„æ–¹æ³•å°±ä¸è¯´, çœ‹ä¸‹å°±çŸ¥é“äº†</span></span><br><span class="line">      <span class="keyword">const</span> warningMessage = getUnexpectedStateShapeWarningMessage(</span><br><span class="line">        state,</span><br><span class="line">        finalReducers,</span><br><span class="line">        action,</span><br><span class="line">        unexpectedKeyCache</span><br><span class="line">      )</span><br><span class="line">      <span class="keyword">if</span> (warningMessage) &#123;</span><br><span class="line">        warning(warningMessage)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è°ƒç”¨reduceræ–¹æ³•</span></span><br><span class="line">    <span class="keyword">let</span> hasChanged = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">const</span> nextState = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> key = finalReducerKeys[i]</span><br><span class="line">      <span class="keyword">const</span> reducer = finalReducers[key]</span><br><span class="line">      <span class="comment">// è·å–å‰ä¸€ä¸ªçŠ¶æ€å€¼</span></span><br><span class="line">      <span class="keyword">const</span> previousStateForKey = state[key]</span><br><span class="line">      <span class="comment">// è°ƒç”¨reducer, è·å–çŠ¶æ€å€¼</span></span><br><span class="line">      <span class="keyword">const</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> nextStateForKey === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> errorMessage = getUndefinedStateErrorMessage(key, action)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(errorMessage)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å­˜æ”¾åˆ°nextStateä¸­</span></span><br><span class="line">      nextState[key] = nextStateForKey</span><br><span class="line">      <span class="comment">// åˆ¤æ–­keyçš„å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–</span></span><br><span class="line">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœå˜åŒ–, è¿”å›nextState, å¦åˆ™è¿˜æ˜¯è¿”å›åŸstateå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> hasChanged ? nextState : state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-applyMiddleware"><a href="#4-applyMiddleware" class="headerlink" title="4. applyMiddleware"></a>4. applyMiddleware</h2><p>é‡ç‚¹æ¥äº†, åˆ«çœ‹ä»–ä»£ç å°‘ï¼ŒçœŸçš„æ˜¯å¤ªç‰¹ä¹ˆéš¾ç†è§£äº†, é«˜èƒ½ã€‚âš¡ï¸ğŸ’¥âœ¨ğŸ’‰</p>
<blockquote>
<p>æˆ‘å…ˆä¸¾ä¸ªæ —å­, ç›´æ¥è®²å®¹æ˜“æ™•</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> middleware1 = <span class="function">(<span class="params">&#123; dispatch &#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware1"</span>);</span><br><span class="line">  next(action);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> middleware2 = <span class="function">(<span class="params">&#123; dispatch &#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware2"</span>);</span><br><span class="line">  next(action);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = Redux.createStore(</span><br><span class="line">  Redux.combineReducers(reducers),</span><br><span class="line">  Redux.applyMiddleware(middleware1, middleware2)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆ†æ</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨ createStore ä¸­, å¦‚æœæœ‰enhancer, é‚£ä¹ˆå°±å¦‚ä¸‹ä»£ç :</span></span><br><span class="line"><span class="comment"> * return enhancer(createStore)(reducer, preloadedState)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params">...middlewares</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1. è¿™é‡Œæ²¡æ¯›ç—…, ä¼ ä¸ªcreateStoreå‡½æ•°è¿›æ¥åˆå§‹åŒ–store</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">createStore</span> =&gt;</span> (...args) =&gt; &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–store</span></span><br><span class="line">    <span class="keyword">const</span> store = createStore(...args)</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ˜¯é˜²æ­¢ä½ åœ¨å®šä¹‰ä¸­é—´ä»¶çš„æ—¶å€™, è°ƒç”¨dispatchå‡½æ•°</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯”å¦‚è¿™æ ·, å°±ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">     * (&#123; dispatch &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="comment">     *   dispatch(xxx)</span></span><br><span class="line"><span class="comment">     *   return next =&gt; action =&gt; &#123; &#125;</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">let</span> dispatch = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">`Dispatching while constructing your middleware is not allowed. `</span> +</span><br><span class="line">          <span class="string">`Other middleware would not be applied to this dispatch.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// âš¡ï¸ æ ¸å¿ƒä¸€: åˆå§‹åŒ–æ‰€æœ‰middlewares</span></span><br><span class="line">    <span class="keyword">const</span> middlewareAPI = &#123;</span><br><span class="line">      getState: store.getState,</span><br><span class="line">      dispatch: <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(...args) <span class="comment">// åˆå§‹åŒ–å, dispatchçš„æŒ‡å‘å°±å˜äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŒºå¥½ç†è§£, ä¼ å…¥ (&#123; dispatch &#125;), è¿”å› next =&gt; action =&gt; &#123; &#125;</span></span><br><span class="line">    <span class="keyword">const</span> chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âš¡ï¸ æ ¸å¿ƒäºŒ: ç»„åˆå‡½æ•°, çœ‹åç»­</span></span><br><span class="line">    dispatch = compose(...chain)(store.dispatch)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¿”å›API, ç”¨æ–°çš„dispatchä»£æ›¿storeä¸­çš„æ—§çš„</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...store,</span><br><span class="line">      dispatch</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆ†æcompose, æœ‰ç‚¹ç„å­¦</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// chain: æ˜¯ next =&gt; action =&gt; &#123; &#125; çš„é›†åˆ, æ˜¯å¤„ç†è¿‡çš„middlewareçš„é›†åˆ</span></span><br><span class="line"><span class="comment">// dispatch = compose(...chain)(store.dispatch)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...funcs</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œé¢çš„argå…¶å®éƒ½æ˜¯ store.dispatch</span></span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> arg</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> (...args) =&gt; a(b(...args)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸‹é¢åˆ†å‡ ç§æƒ…å†µ, ä¾¿äºç†è§£</p>
</blockquote>
<ul>
<li>1ã€ å¦‚æœæ²¡æœ‰ä¸­é—´ä»¶</li>
</ul>
<p>é‚£ä¹ˆ <code>dispatch</code> = <code>(store.dispatch) =&gt; (store.dispatch)</code>, è¿”å›é»˜è®¤çš„dispatch, æ²¡æ¯›ç—…</p>
<ul>
<li>2ã€ å¦‚æœæœ‰ä¸€ä¸ªä¸­é—´ä»¶, å‡è®¾ chain æ˜¯ <code>next =&gt; action =&gt; { }</code></li>
</ul>
<p>é‚£ä¹ˆ <code>dispatch</code> = <code>chain(store.dispatch)</code>, è¿”å›æ˜¯ä¸­é—´ä»¶å†…éƒ¨çš„ <code>action =&gt; { ... }</code><br>ç„¶ååœ¨ä½¿ç”¨dispatch actionçš„æ—¶å€™, ä¼šå…ˆè°ƒç”¨æˆ‘å®šä¹‰çš„ä¸­é—´ä»¶å†…éƒ¨çš„ <code>action =&gt; { ... }</code>, ç„¶åæˆ‘æ‰§è¡Œçš„é‚£ä¸ª<code>next</code>å°±æ˜¯<code>åŸå…ˆçš„store.dispatchå¯¹è±¡</code>, è°ƒç”¨<code>next(action)</code>å°±æ˜¯<code>åŸç”Ÿdispatch</code>, è¿™æ ·å°±ä¸²èµ·æ¥äº†, æ²¡æ¯›ç—…</p>
<ul>
<li>3ã€ å¦‚æœæœ‰ä¸¤ä¸ªä¸­é—´ä»¶, è¿”å›çš„æ˜¯ä¸ªç»„åˆå‡½æ•°, æœ€ä¸å¥½ç†è§£çš„ä¸€ä¸ª</li>
</ul>
<p>ç°åœ¨ <code>aå’Œb</code>éƒ½æ˜¯ <code>next =&gt; action =&gt; { }</code>, <code>argsæ˜¯store.dispatch</code>.<br>(1)é¦–å…ˆæ‰§è¡Œ <code>b(store.dispatch)</code>, è¿”å›çš„æ˜¯<code>b</code>çš„ <code>action =&gt; { }</code>, ä¼ ç»™<code>a</code>ï¼ˆ<strong>è¿™é‡Œå¾ˆå…³é”®, açš„nextå…¶å®å°±æ˜¯bå†…éƒ¨çš„action =&gt; { }ï¼‰</strong><br>(2)ç„¶åæ‰§è¡Œ <code>a(bå†…éƒ¨çš„action =&gt; {})</code>, è¿”å›çš„æ˜¯<code>a</code>çš„<code>action =&gt; { }</code><br>(3)æœ€åæŠŠ<code>a</code>çš„<code>action =&gt; { }</code>è¿”å›ç»™APIä½¿ç”¨ã€‚</p>
<p>åœ¨æ¥çœ‹çœ‹å½“æˆ‘ä»¬ä½¿ç”¨<code>dispatch(action)</code>çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆ!!!<br>(1)é¦–å…ˆæ‰§è¡Œ<code>aä¸­é—´ä»¶å†…éƒ¨çš„action =&gt; { }</code>, è°ƒç”¨next(action), nextæ˜¯<code>bä¸­é—´ä»¶å†…éƒ¨çš„action =&gt; { }</code><br>(2)<code>b</code>ä¸­çš„nextæ˜¯<code>store.dispatch</code>, ç„¶ååœ¨next(action), è¿™æ ·å°±ä¸²èµ·æ¥äº†</p>
<ul>
<li>4ã€å¾ˆå¤šä¸­é—´ä»¶, åˆ†æç±»ä¼¼, è‡ªè¡Œä½“ä¼š.ğŸ˜‚</li>
</ul>
<h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><p>applyMiddlewareé‚£å—ç»„åˆå‡½æ•°ç¡®å®æŒºç²¾é«“çš„, è¿˜æœ‰å„ç§é—­åŒ…çš„ä½¿ç”¨ä¹Ÿæ˜¯ç‰¹åˆ«å¥½, æ•´ä¸ªreduxæºç ä¸æ˜¯ç‰¹åˆ«å¤š, ç»™æˆ‘ä¸ªäººæ„Ÿè§‰å°±æ˜¯ï¼š<code>å§æ§½æ§½æ§½!!!å†™çš„å¥½å±Œ!!!</code>ã€‚</p>
<p><img src="http://ice-img.dreamylost.cn/2018-12-08-093351.png" alt=""></p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/JavaScript/">JavaScript</a><a href="/tags/react/">react</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://www.patamon.me/icemimosa/JavaScript/Reduxæºç è§£æ/" data-title="Reduxæºç è§£æ | Ice ã® Mimosa" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/icemimosa/pulsar/BookkeeperåŸºæœ¬ä½¿ç”¨/" title="BookKeeperåŸºæœ¬ä½¿ç”¨">
  <strong>PREVIOUS:</strong><br>
  <span>
  BookKeeperåŸºæœ¬ä½¿ç”¨</span>
</a>
</div>


<div class="next">
<a href="/icemimosa/spark/Sparkè‡ªå®šä¹‰WindowFunction/" title="Sparkè‡ªå®šä¹‰WindowFunction">
 <strong>NEXT:</strong><br> 
 <span>Sparkè‡ªå®šä¹‰WindowFunction
</span>
</a>
</div>

</nav>

	


<!--PCå’ŒWAPè‡ªé€‚åº”ç‰ˆ-->
<div id="SOHUCS" class="comment"></div>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="æ˜¾ç¤ºä¾§è¾¹æ "></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Reduxæºç è§£æ"><span class="toc-text">Reduxæºç è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-index-js"><span class="toc-text">1. index.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-createStore"><span class="toc-text">2. createStore</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-store-subscribe"><span class="toc-text">2.1 store.subscribe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-store-dispatch"><span class="toc-text">2.2 store.dispatch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-store-getState"><span class="toc-text">2.3 store.getState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-store-replaceReducer"><span class="toc-text">2.4 store.replaceReducer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-combineReducers"><span class="toc-text">3. combineReducers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-applyMiddleware"><span class="toc-text">4. applyMiddleware</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-æ€»ç»“"><span class="toc-text">5. æ€»ç»“</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="éšè—ä¾§è¾¹æ "></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-logo"></div>		
	
	<div class="social-list">
		
		<a href="http://weibo.com/3699593035" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/IceMimosa" target="_blank" title="github"></a>
		
		
		
		
		<a href="mailto:514793425@qq.com" target="_blank" title="email"></a>
		
	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">åˆ†ç±»</p>
		<ul>
		
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>2</sup></a></li>
		
			<li><a href="/categories/hadoop/" title="hadoop">hadoop<sup>2</sup></a></li>
		
			<li><a href="/categories/hbase/" title="hbase">hbase<sup>12</sup></a></li>
		
			<li><a href="/categories/hive/" title="hive">hive<sup>11</sup></a></li>
		
			<li><a href="/categories/java/" title="java">java<sup>26</sup></a></li>
		
			<li><a href="/categories/kotlin/" title="kotlin">kotlin<sup>1</sup></a></li>
		
			<li><a href="/categories/oozie/" title="oozie">oozie<sup>10</sup></a></li>
		
			<li><a href="/categories/pulsar/" title="pulsar">pulsar<sup>1</sup></a></li>
		
			<li><a href="/categories/redis/" title="redis">redis<sup>13</sup></a></li>
		
			<li><a href="/categories/spark/" title="spark">spark<sup>5</sup></a></li>
		
			<li><a href="/categories/springboot/" title="springboot">springboot<sup>2</sup></a></li>
		
			<li><a href="/categories/sqoop/" title="sqoop">sqoop<sup>3</sup></a></li>
		
			<li><a href="/categories/æ•°ä»“/" title="æ•°ä»“">æ•°ä»“<sup>4</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">æ ‡ç­¾</p>
		<ul class="clearfix">
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>2</sup></a></li>
		
			<li><a href="/tags/hadoop/" title="hadoop">hadoop<sup>11</sup></a></li>
		
			<li><a href="/tags/hbase/" title="hbase">hbase<sup>12</sup></a></li>
		
			<li><a href="/tags/hive/" title="hive">hive<sup>11</sup></a></li>
		
			<li><a href="/tags/impala/" title="impala">impala<sup>1</sup></a></li>
		
			<li><a href="/tags/java/" title="java">java<sup>27</sup></a></li>
		
			<li><a href="/tags/kotlin/" title="kotlin">kotlin<sup>1</sup></a></li>
		
			<li><a href="/tags/lombok/" title="lombok">lombok<sup>3</sup></a></li>
		
			<li><a href="/tags/mac/" title="mac">mac<sup>2</sup></a></li>
		
			<li><a href="/tags/mysql/" title="mysql">mysql<sup>1</sup></a></li>
		
			<li><a href="/tags/olap/" title="olap">olap<sup>4</sup></a></li>
		
			<li><a href="/tags/oozie/" title="oozie">oozie<sup>10</sup></a></li>
		
			<li><a href="/tags/pulsar/" title="pulsar">pulsar<sup>1</sup></a></li>
		
			<li><a href="/tags/react/" title="react">react<sup>1</sup></a></li>
		
			<li><a href="/tags/redis/" title="redis">redis<sup>13</sup></a></li>
		
			<li><a href="/tags/spark/" title="spark">spark<sup>5</sup></a></li>
		
			<li><a href="/tags/spring/" title="spring">spring<sup>2</sup></a></li>
		
			<li><a href="/tags/springboot/" title="springboot">springboot<sup>2</sup></a></li>
		
			<li><a href="/tags/sqoop/" title="sqoop">sqoop<sup>4</sup></a></li>
		
			<li><a href="/tags/æ•°ä»“/" title="æ•°ä»“">æ•°ä»“<sup>4</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS è®¢é˜…</a>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">æ ‡ç­¾äº‘</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/JavaScript/" style="font-size: 11px;">JavaScript</a> <a href="/tags/hadoop/" style="font-size: 16px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 17px;">hbase</a> <a href="/tags/hive/" style="font-size: 16px;">hive</a> <a href="/tags/impala/" style="font-size: 10px;">impala</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/kotlin/" style="font-size: 10px;">kotlin</a> <a href="/tags/lombok/" style="font-size: 12px;">lombok</a> <a href="/tags/mac/" style="font-size: 11px;">mac</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/olap/" style="font-size: 13px;">olap</a> <a href="/tags/oozie/" style="font-size: 15px;">oozie</a> <a href="/tags/pulsar/" style="font-size: 10px;">pulsar</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/redis/" style="font-size: 18px;">redis</a> <a href="/tags/spark/" style="font-size: 14px;">spark</a> <a href="/tags/spring/" style="font-size: 11px;">spring</a> <a href="/tags/springboot/" style="font-size: 11px;">springboot</a> <a href="/tags/sqoop/" style="font-size: 13px;">sqoop</a> <a href="/tags/æ•°ä»“/" style="font-size: 13px;">æ•°ä»“</a> <a href="/tags/æºç /" style="font-size: 19px;">æºç </a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer">
    
            <p class="copyright"> Â© 2023 
		
		<a href="http://www.patamon.me" target="_blank" title="IceMimosa">IceMimosa</a>
		
            <!-- && Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> && Theme by <a href="http://gengbiao.me" target="_blank" title="coney">coney</a> -->
            â– Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a>
            </p></div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script src="/js/jquery-icemi-scroll2top.js"></script>
<script src="/js/other.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  
  // å›åˆ°é¡¶éƒ¨
  $(document.body).scroll2Top({
    background:"#66ccff",
    shape:"circle",
    bottom:40,
    right:250
  });

  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    // m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,332-$(this).scrollTop()));
  });
});
</script>

<!-- GrowingIO Analytics code version 2.1 -->
<!-- Copyright 2015-2018 GrowingIO, Inc. More info available at http://www.growingio.com -->
<script type="text/javascript">
!function(e,t,n,g,i){e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=('https:'==document.location.protocol?'https://':'http://')+g,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.growingio.com/2.1/gio.js","gio");
gio('init','b988cbf13dfaa5ac', {});
//custom page code begin here

//custom page code end here
gio('send');
</script>
<!-- End GrowingIO Analytics code version: 2.1 -->


<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    // t.css('display','none');
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    $(window).scroll(function(){
      ta.css("top", Math.max(140,380-$(this).scrollTop()));
      ta.css("right", 65);
    });
    o.click(function(){
      ta.css('display', 'none');
    });
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top", Math.max(140,380-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>æ‰«æäºŒç»´ç åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>




<script type="text/javascript"> 
  (function(){ 
    var appid = "cyt6xqnNX";
    var conf = 'prod_97c2bd32b8416b2df1809e56a3f6d431'; 
    var width = window.innerWidth || document.documentElement.clientWidth; 
    if (width < 960) { 
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); 
    } else { 
      var loadJs = function(d,a) {
        var c = document.getElementsByTagName("head")[0]||document.head||document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type","text/javascript");
        b.setAttribute("charset","UTF-8");
        b.setAttribute("src",d);
        if(typeof a==="function") {
          if(window.attachEvent) {
            b.onreadystatechange = function() {
              var e = b.readyState;
              if(e==="loaded"||e==="complete") {
                b.onreadystatechange=null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)};
        loadJs("https://changyan.sohu.com/upload/changyan.js",
          function() {
            window.changyan.api.config({
              appid: appid, 
              conf: conf
            })
          }
        ); 
      } 
    })();
</script> 






<script>
    
        var _bdImg = '4';
    
    window._bd_share_config={
        "common":{
            "bdSnsKey":{

            },
            "bdText":"",
            "bdMini":"2",
            "bdMiniList":[
                "qzone",
                "tsina",
                "weixin",
                "renren",
                "tqq",
                "tieba",
                "douban",
                "sqq",
                "diandian",
                "huaban",
                "youdao",
                "mail",
                "ty",
                "fbook",
                "twi",
                "linkedin",
                "copy",
                "print"
            ],
            "bdPic":"",
            "bdStyle":"0",
            "bdSize":"16"
        },
        "slide":{
            "type":"slide",
            "bdImg":_bdImg,
            "bdPos":"right",
            "bdTop":"350"
        },
        "image":{
            "viewList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ],
            "viewText":"åˆ†äº«ï¼š",
            "viewSize":"16"
        },
        "selectShare":{
            "bdContainerClass":null,
            "bdSelectMiniList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ]
        }
    };
    with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>




<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>


  <script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":100,"height":200,"hOffset":240,"vOffset":-45},"mobile":{"show":false},"log":false,"tagMode":false});</script></body>
</html>

