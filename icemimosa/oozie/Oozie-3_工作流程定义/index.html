
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="baidu_union_verify" content="d1952c66cf48912e21c18c7c581f382a">
  <meta name="360-site-verification" content="67fbcc5a67f4c65c057315b28fa0b2c8">
<meta name="google-site-verification" content="2GzxQ0VtXwTSUdmGm6DzcmhTzM_I9QmzCb_pzpMzD88">
  
    <title>Oozie-3_工作流程定义 | Ice の Mimosa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="IceMimosa">
    
    <meta name="description" content="Oozie-3_工作流程定义[TOC]
1. 简介
Workflow Application


DAG（Directed Acyclical Graphs）, 有向无环图。
如果存在Cycle, Oozie会立即fail。


HPDL：Hadoop Process Definition Lang">
    
    
    
    
    <link rel="alternate" href="atom.xml" title="Ice の Mimosa" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon_mine.ico">
    
    
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/jquery-icemi-scroll2top.css">
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            var _bdId ='1cb536fd996cddc96154515a1ed1d72d';
             hm.src = "//hm.baidu.com/hm.js?" + _bdId;
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
        })();
    </script>
     
</head>
</html>
  <body>
    <header>
      <div id="banner">
		

			<div id="erer" class="erer" style="">
				<!-- <img id="i22" src="/img/22.png" width=200 height=230></img> -->
				<!-- <img id="i22" src="http://ice-img.dreamylost.cn/patamon-22.png" width=200 height=230></img> -->
			</div>

			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Ice の Mimosa">Ice の Mimosa</a></h1>
				<a class="blog-motto">没有未来的未来不是我想要的未来</a>
			</div>

			<div id="sansan" class="sansan" style="">
				<!-- <img src="/img/33.png" width=200 height=230></img> -->
				<!-- <img src="http://ice-img.dreamylost.cn/patamon-33.png" width=200 height=230></img> -->
			</div> 

			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/categories">分类</a></li>
					
					<li>
					
                                            <form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
                                            <label>Search</label>
                                        <input name="s" type="hidden" value="8360843150509117428"><input type="text" name="q" size="30" placeholder="搜索"><br>
					
					</form></li>
				</ul>
			</ul></nav>
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope="" itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/icemimosa/oozie/Oozie-3_工作流程定义/" title="Oozie-3_工作流程定义" itemprop="url">Oozie-3_工作流程定义</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://www.patamon.me" title="IceMimosa">IceMimosa</a>
    </p>
  <p class="article-time">
    <time datetime="2016-07-11T07:30:16.000Z" itemprop="datePublished">2016-07-11</time>
    更新日期:<time datetime="2023-02-15T14:15:04.575Z" itemprop="dateModified">2023-02-15</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Oozie-3-工作流程定义"><span class="toc-text">Oozie-3_工作流程定义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-简介"><span class="toc-text">1. 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-流程定义"><span class="toc-text">2. 流程定义</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-控制节点"><span class="toc-text">2.1 控制节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-start-节点"><span class="toc-text">2.1.1 start 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-end-节点"><span class="toc-text">2.1.2 end 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-kill-节点"><span class="toc-text">2.1.3 kill 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-decision-节点"><span class="toc-text">2.1.4 decision 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-fork-和-join-节点"><span class="toc-text">2.1.5 fork 和 join 节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-动作节点"><span class="toc-text">2.2 动作节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-Action-Basics-基本特性"><span class="toc-text">2.2.1 Action Basics 基本特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-Map-Reduce-Action"><span class="toc-text">2.2.2 Map-Reduce Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-Pig-Action"><span class="toc-text">2.2.4 Pig Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-5-Hive-Action"><span class="toc-text">2.2.5 Hive Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-6-Fs-HDFS-action"><span class="toc-text">2.2.6 Fs (HDFS) action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-7-SSH-Action"><span class="toc-text">2.2.7 SSH Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-8-Sub-workflow-Action"><span class="toc-text">2.2.8 Sub-workflow Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-9-Java-Action"><span class="toc-text">2.2.9 Java Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-10-Email-Action"><span class="toc-text">2.2.10 Email Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-11-Spark-节点"><span class="toc-text">2.2.11 Spark 节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-12-spark执行python"><span class="toc-text">2.2.12 spark执行python</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-流程定义中的参数化（EL-表达式）"><span class="toc-text">3. 流程定义中的参数化（EL 表达式）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-变量"><span class="toc-text">3.1 变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-方法"><span class="toc-text">3.2 方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-工作流回调"><span class="toc-text">4. 工作流回调</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-工作流程部署"><span class="toc-text">5. 工作流程部署</span></a></li></ol>
		</div>
		
		<h1 id="Oozie-3-工作流程定义"><a href="#Oozie-3-工作流程定义" class="headerlink" title="Oozie-3_工作流程定义"></a>Oozie-3_工作流程定义</h1><p>[TOC]</p>
<h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><blockquote>
<p>Workflow Application</p>
</blockquote>
<ul>
<li>DAG（Directed Acyclical Graphs）, 有向无环图。<ul>
<li>如果存在Cycle, Oozie会立即fail。</li>
</ul>
</li>
<li>HPDL：Hadoop Process Definition Language（xml）<ul>
<li>schema文件：<a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#OozieWFSchema" title="Oozie workflow definition schema" target="_blank" rel="noopener">Oozie Workflow Definition Schema</a></li>
</ul>
</li>
<li>流程定义组成：<code>控制流节点</code> 和 <code>动作节点</code></li>
<li>xml中支持 <code>Java EL 表达式</code></li>
<li>支持action节点的start/end/failure 和 workflow end/failure的 HTTP 回调</li>
</ul>
<p>每个workflow job的包括的状态：<code>PREP</code> , <code>RUNNING</code> , <code>SUSPENDED</code> , <code>SUCCEEDED</code> , <code>KILLED</code> and <code>FAILED</code></p>
<blockquote>
<p>生命周期：</p>
</blockquote>
<table>
<thead>
<tr>
<th>前</th>
<th>–&gt;</th>
<th>后</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>–&gt;</td>
<td>PREP</td>
</tr>
<tr>
<td>PREP</td>
<td>–&gt;</td>
<td>RUNNING、KILLED</td>
</tr>
<tr>
<td>RUNNING</td>
<td>–&gt;</td>
<td>SUSPENDED 、 SUCCEEDED 、 KILLED 、 FAILED</td>
</tr>
<tr>
<td>SUSPENDED</td>
<td>–&gt;</td>
<td>RUNNING 、 KILLED</td>
</tr>
</tbody>
</table>
<h1 id="2-流程定义"><a href="#2-流程定义" class="headerlink" title="2. 流程定义"></a>2. 流程定义</h1><p>一个流程定义包含 <code>control flow nodes</code> 和 <code>action nodes</code> , 节点之间通过 <code>箭头连线</code> 连接。</p>
<ul>
<li>控制流节点：<code>start</code>, <code>end</code>, <code>decision</code>, <code>fork</code>, <code>join</code>, <code>kill</code></li>
<li>动作节点：<code>map-reduce</code>, <code>pig</code>, <code>hive</code> 等等。</li>
</ul>
<h2 id="2-1-控制节点"><a href="#2-1-控制节点" class="headerlink" title="2.1 控制节点"></a>2.1 控制节点</h2><h3 id="2-1-1-start-节点"><a href="#2-1-1-start-节点" class="headerlink" title="2.1.1 start 节点"></a>2.1.1 start 节点</h3><ol>
<li>start节点是流程定义的开始节点，必须存在且只能存在一个。</li>
<li>当流程启动的时候，会自动流向start节点定义的下一个节点。</li>
</ol>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">start</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># to：指向的下一个节点（节点名称）</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"foo-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">start</span> <span class="attr">to</span>=<span class="string">"firstHadoopJob"</span>/&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-1-2-end-节点"><a href="#2-1-2-end-节点" class="headerlink" title="2.1.2 end 节点"></a>2.1.2 end 节点</h3><ol>
<li>end节点是流程定义的结束节点，表示流程执行 <code>成功</code> （SUCCEEDED）。</li>
<li>当多个任务指向end节点，一个action到达end的时候，其他actions就会被 kill，但是这种情况也会被视为 SUCCEEDED。</li>
<li>end必须存在且只能存在一个。</li>
</ol>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">end</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># name：表示节点的名称</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"foo-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">end</span> <span class="attr">name</span>=<span class="string">"end"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-1-3-kill-节点"><a href="#2-1-3-kill-节点" class="headerlink" title="2.1.3 kill 节点"></a>2.1.3 kill 节点</h3><ol>
<li>kill节点允许workflow job执行 kill 操作。当job到达kill节点的时候，表示job执行出错。</li>
<li>同理当多个action指向kill节点，有一个到达，其他actions将被kill。</li>
<li>kill节点可以有 0 或多个</li>
</ol>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">kill</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">message</span>&gt;</span>[MESSAGE-TO-LOG]<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">kill</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># kill节点没有连线节点。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"foo-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">kill</span> <span class="attr">name</span>=<span class="string">"killBecauseNoInput"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">message</span>&gt;</span>Input unavailable<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">kill</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-1-4-decision-节点"><a href="#2-1-4-decision-节点" class="headerlink" title="2.1.4 decision 节点"></a>2.1.4 decision 节点</h3><ol>
<li>decision节点允许流程对节点的流向做出选择，就行switch-case一样。</li>
<li>节点需要根据表达式（true or false）做出选择，表达式是JSP Expression Language(EL)。</li>
</ol>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">decision</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">switch</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">case</span> <span class="attr">to</span>=<span class="string">"[NODE_NAME]"</span>&gt;</span>[PREDICATE]<span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	       ...</span><br><span class="line">	       <span class="tag">&lt;<span class="name">case</span> <span class="attr">to</span>=<span class="string">"[NODE_NAME]"</span>&gt;</span>[PREDICATE]<span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">default</span> <span class="attr">to</span>=<span class="string">"[NODE_NAME]"</span>/&gt;</span></span><br><span class="line">	   <span class="tag">&lt;/<span class="name">switch</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">decision</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># PREDICATE：EL表达式</span><br><span class="line"># 必须有一个default节点，避免不必要的错误</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"foo-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">decision</span> <span class="attr">name</span>=<span class="string">"mydecision"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">switch</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">case</span> <span class="attr">to</span>=<span class="string">"reconsolidatejob"</span>&gt;</span></span><br><span class="line">	         $&#123;fs:fileSize(secondjobOutputDir) gt 10 * GB&#125;</span><br><span class="line">	       <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">case</span> <span class="attr">to</span>=<span class="string">"rexpandjob"</span>&gt;</span></span><br><span class="line">	         $&#123;fs:filSize(secondjobOutputDir) lt 100 * MB&#125;</span><br><span class="line">	       <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">case</span> <span class="attr">to</span>=<span class="string">"recomputejob"</span>&gt;</span></span><br><span class="line">	         $&#123; hadoop:counters('secondjob')[RECORDS][REDUCE_OUT] lt 1000000 &#125;</span><br><span class="line">	       <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">default</span> <span class="attr">to</span>=<span class="string">"end"</span>/&gt;</span></span><br><span class="line">	   <span class="tag">&lt;/<span class="name">switch</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">decision</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-1-5-fork-和-join-节点"><a href="#2-1-5-fork-和-join-节点" class="headerlink" title="2.1.5 fork 和 join 节点"></a>2.1.5 fork 和 join 节点</h3><ol>
<li>fork允许将一条路径分支成多个路径执行。</li>
<li>join等待当前 <code>上个fork节点</code> 的每个执行连线到达。</li>
<li>fork和join必须 <code>成对出现</code>。</li>
</ol>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">fork</span> <span class="attr">name</span>=<span class="string">"[FORK-NODE-NAME]"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">path</span> <span class="attr">start</span>=<span class="string">"[NODE-NAME]"</span> /&gt;</span></span><br><span class="line">	   ...</span><br><span class="line">	   <span class="tag">&lt;<span class="name">path</span> <span class="attr">start</span>=<span class="string">"[NODE-NAME]"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">join</span> <span class="attr">name</span>=<span class="string">"[JOIN-NODE-NAME]"</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span> /&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"sample-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">fork</span> <span class="attr">name</span>=<span class="string">"forking"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">path</span> <span class="attr">start</span>=<span class="string">"firstparalleljob"</span>/&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">path</span> <span class="attr">start</span>=<span class="string">"secondparalleljob"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"firstparallejob"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>job1.xml<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;/<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"joining"</span>/&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"kill"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"secondparalleljob"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>job2.xml<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;/<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"joining"</span>/&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"kill"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">join</span> <span class="attr">name</span>=<span class="string">"joining"</span> <span class="attr">to</span>=<span class="string">"nextaction"</span>/&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>tips: Oozie默认提供fork和join的校验机制。如果你确保workflow能够执行，可以关闭forkjoin校验。<br>方式一（局部）：在 <code>job.properties</code> 中指定 <code>oozie.wf.validate.ForkJoin</code> 为false<br>方式二（全局）：在 <code>oozie-site.xml</code> 中指定 <code>oozie.validate.ForkJoin</code> 为false</p>
</blockquote>
<h2 id="2-2-动作节点"><a href="#2-2-动作节点" class="headerlink" title="2.2 动作节点"></a>2.2 动作节点</h2><p>Action Nodes可以被认为是工作流触发的 <code>computation</code>（计算） / <code>processing</code>（处理） 任务。</p>
<h3 id="2-2-1-Action-Basics-基本特性"><a href="#2-2-1-Action-Basics-基本特性" class="headerlink" title="2.2.1 Action Basics 基本特性"></a>2.2.1 Action Basics 基本特性</h3><blockquote>
<p>1、 远程执行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于Oozie而言，这些触发的任务都是处在远程机器上的。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>2、 异步执行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对于Oozie而言，任务的触发的都是异步的。所以Oozie必须等待Action执行完毕才能继续执行下一个Action Node. Oozie有两种方式去探测执行的任务： 回调 和 轮询</span><br><span class="line">1. 回调：当一个任务执行，Oozie会提供一个唯一的回调URL，每个任务需要执行URL进行通知。</span><br><span class="line">2. 轮询：有时候因为网络等原因，并不能成功进行URL回调。这是Oozie就会去轮询执行的任务。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>3、OK 和 ERROR</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">每个Action都有只有两个节点流向：OK 和 ERROR</span><br><span class="line">1. 如果任务成功执行完毕，就会转向 ok 节点</span><br><span class="line">2. 否则转向 error 节点，并且需要向Oozie提供 error-code 和 error-message 等信息</span><br></pre></td></tr></table></figure>
<blockquote>
<p>4、恢复机制</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Oozie 为执行失败的任务提供了恢复的机制。</span><br><span class="line">1. 如果是失败是在状态转移的时候（如网络，远程机无法访问等），Oozie就会根据预定的重试时间间隔和重试次数去执行</span><br><span class="line">2. 如果不是在状态转移发生异常，Job就会被Suspend，需要手动去恢复</span><br><span class="line"></span><br><span class="line">如果一直重试还是不能解决问题，那么Oozie直接将任务流向 error 节点。</span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-Map-Reduce-Action"><a href="#2-2-2-Map-Reduce-Action" class="headerlink" title="2.2.2 Map-Reduce Action"></a>2.2.2 Map-Reduce Action</h3><ol>
<li>Map-Reduce jobs可以预先对HDFS进行目录的清理和初始化。</li>
<li>properties的配置可以配置在如下文件中，且后者覆盖前者<ol>
<li>the config-default.xml</li>
<li>JobConf XML file bundled with the workflow application</li>
<li>tag in workflow definition </li>
<li>Inline map-reduce action configuration</li>
</ol>
</li>
<li>配置都可以是 EL 表达式</li>
</ol>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>[JOB-TRACKER]<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>[NAME-NODE]<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">	           ...</span><br><span class="line">	           <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">	           ...</span><br><span class="line">	       <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">streaming</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">mapper</span>&gt;</span>[MAPPER-PROCESS]<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">reducer</span>&gt;</span>[REDUCER-PROCESS]<span class="tag">&lt;/<span class="name">reducer</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">record-reader</span>&gt;</span>[RECORD-READER-CLASS]<span class="tag">&lt;/<span class="name">record-reader</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">record-reader-mapping</span>&gt;</span>[NAME=VALUE]<span class="tag">&lt;/<span class="name">record-reader-mapping</span>&gt;</span></span><br><span class="line">	           ...</span><br><span class="line">	           <span class="tag">&lt;<span class="name">env</span>&gt;</span>[NAME=VALUE]<span class="tag">&lt;/<span class="name">env</span>&gt;</span></span><br><span class="line">	           ...</span><br><span class="line">	       <span class="tag">&lt;/<span class="name">streaming</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- Either streaming or pipes can be specified for an action, not both --&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">pipes</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">map</span>&gt;</span>[MAPPER]<span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">reduce</span>&gt;</span>[REDUCER]<span class="tag">&lt;/<span class="name">reducer</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">inputformat</span>&gt;</span>[INPUTFORMAT]<span class="tag">&lt;/<span class="name">inputformat</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">partitioner</span>&gt;</span>[PARTITIONER]<span class="tag">&lt;/<span class="name">partitioner</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">writer</span>&gt;</span>[OUTPUTFORMAT]<span class="tag">&lt;/<span class="name">writer</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">program</span>&gt;</span>[EXECUTABLE]<span class="tag">&lt;/<span class="name">program</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;/<span class="name">pipes</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>[JOB-XML-FILE]<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	               <span class="tag">&lt;<span class="name">name</span>&gt;</span>[PROPERTY-NAME]<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	               <span class="tag">&lt;<span class="name">value</span>&gt;</span>[PROPERTY-VALUE]<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	           <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	           ...</span><br><span class="line">	       <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">	       <span class="tag">&lt;<span class="name">file</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">	       ...</span><br><span class="line">	       <span class="tag">&lt;<span class="name">archive</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">	       ...</span><br><span class="line">	   <span class="tag">&lt;/<span class="name">map-reduce</span>&gt;</span>        </span><br><span class="line">	   <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># name-node 和 job-tracker 都是必须的</span><br><span class="line"># prepare 表示执行前的准备工作</span><br><span class="line"># streaming 和 pipes: hadoop streaming和pipes的支持，只能指定其中一个</span><br><span class="line"># job-xml：指向 JobConf 的 job.xml, 但是里面的配置会被 configuration节点覆盖。</span><br><span class="line">``` 	</span><br><span class="line"></span><br><span class="line">&gt; 例子：</span><br><span class="line"></span><br><span class="line">* 标准example</span><br><span class="line">* Streaming Example</span><br><span class="line">* Pipes Example</span><br><span class="line">* 参考：[Map-Reduce示例][2]</span><br><span class="line"></span><br><span class="line">### 2.2.3 Sqoop Action</span><br><span class="line"></span><br><span class="line">1. 运行一个Sqoop Job，需要配置 `job-tracker`, `name-node`, `command`和一些其他配置</span><br><span class="line"></span><br><span class="line">&gt; 语法：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqoop</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:sqoop-action:0.2"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>[JOB-TRACKER]<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>[NAME-NODE]<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">               <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>[PROPERTY-NAME]<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>[PROPERTY-VALUE]<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">command</span>&gt;</span>[SQOOP-COMMAND]<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span>[SQOOP-ARGUMENT]<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">file</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">archive</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqoop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line">## command：执行的sqoop命令，比如一条完整的命令：</span><br><span class="line">	* import  --connect jdbc:hsqldb:file:db.hsqldb --table TT --target-dir hdfs://localhost:8020/user/tucu/foo -m 1</span><br><span class="line">	</span><br><span class="line">## arg：可以将命令的一些参数写在里面，比如：</span><br><span class="line">	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>import<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>--connect<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>jdbc:hsqldb:file:db.hsqldb<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>--table<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>TT<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line"> 	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>--target-dir<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line"> 	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>hdfs://localhost:8020/user/tucu/foo<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line"> 	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>-m<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line"> 	* <span class="tag">&lt;<span class="name">arg</span>&gt;</span>1<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;workflow-app name=&quot;workflow-app-sqoop&quot; xmlns=&quot;uri:oozie:workflow:0.2&quot;&gt;</span><br><span class="line">	&lt;start to=&quot;sqoop&quot;/&gt;</span><br><span class="line">	&lt;action name=&quot;sqoop&quot;&gt;</span><br><span class="line">		&lt;sqoop xmlns=&quot;uri:oozie:sqoop-action:0.2&quot;&gt;</span><br><span class="line">			&lt;job-tracker&gt;localhost:8032&lt;/job-tracker&gt;</span><br><span class="line">			&lt;name-node&gt;hdfs://localhost:9000&lt;/name-node&gt;</span><br><span class="line">			&lt;configuration&gt;</span><br><span class="line">				&lt;property&gt;</span><br><span class="line">					&lt;name&gt;mapred.job.queue.name&lt;/name&gt;</span><br><span class="line">					&lt;value&gt;default&lt;/value&gt;</span><br><span class="line">				&lt;/property&gt;</span><br><span class="line">			&lt;/configuration&gt;</span><br><span class="line">			&lt;command&gt; import --connect jdbc:mysql://localhost:3306/test --username root --password ****** --table  users -m 1 --target-dir /mimosa/test/users  &lt;/command&gt;</span><br><span class="line">		&lt;/sqoop&gt;</span><br><span class="line">		&lt;ok to=&quot;end&quot;/&gt;</span><br><span class="line">		&lt;error to=&quot;kill&quot;/&gt;</span><br><span class="line">	&lt;/action&gt;</span><br><span class="line">	&lt;kill name=&quot;kill&quot;&gt;</span><br><span class="line">		&lt;message&gt; Map/Reduce failed, error message[\$\&#123;wf:errorMessage(wf:lastErrorNode())&#125;] &lt;/message&gt;</span><br><span class="line">	&lt;/kill&gt;</span><br><span class="line">	&lt;end name=&quot;end&quot;/&gt;</span><br><span class="line">&lt;/workflow-app&gt;</span><br><span class="line"></span><br><span class="line"># --password 的密码自行修改</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：<br>1、由于使用到了mysql的数据源，需要将mysql的驱动包拷贝到Oozie sharelib的sqoop目录下。<br>2、运行实质就是执行 sqoop 的命令。</p>
</blockquote>
<h3 id="2-2-4-Pig-Action"><a href="#2-2-4-Pig-Action" class="headerlink" title="2.2.4 Pig Action"></a>2.2.4 Pig Action</h3><ol>
<li>Pig Job需要配置 <code>job-tracker</code>, <code>name-node</code>, <code>pig script</code>和一些其他配置</li>
<li>配置的一些说明基本与Map-Reduce一致</li>
<li><code>script</code> 中可以包含 <code>${var}</code>, var 需要在 <code>param</code>节点中指定</li>
</ol>
<blockquote>
<p>语法(schema 0.2)：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.2"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pig</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>[JOB-TRACKER]<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>[NAME-NODE]<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">               <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>[JOB-XML-FILE]<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>[PROPERTY-NAME]<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>[PROPERTY-VALUE]<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">[PIG-SCRIPT]</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span>&gt;</span>[PARAM-VALUE]<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span>&gt;</span>[PARAM-VALUE]<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">argument</span>&gt;</span>[ARGUMENT-VALUE]<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">argument</span>&gt;</span>[ARGUMENT-VALUE]<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">file</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">archive</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">pig</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Example(schema 0.2):</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"sample-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.2"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"myfirstpigjob"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pig</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"$&#123;jobOutput&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.compress.map.output<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.action.external.stats.write<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">/mypigscript.pig</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">argument</span>&gt;</span>-param<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">argument</span>&gt;</span>INPUT=$&#123;inputDir&#125;<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">argument</span>&gt;</span>-param<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">argument</span>&gt;</span>OUTPUT=$&#123;outputDir&#125;/pig-output3<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pig</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"myotherjob"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"errorcleanup"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>语法 (schema 0.1)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;workflow-app name=&quot;[WF-DEF-NAME]&quot; xmlns=&quot;uri:oozie:workflow:0.1&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;action name=&quot;[NODE-NAME]&quot;&gt;</span><br><span class="line">        &lt;pig&gt;</span><br><span class="line">            &lt;job-tracker&gt;[JOB-TRACKER]&lt;/job-tracker&gt;</span><br><span class="line">            &lt;name-node&gt;[NAME-NODE]&lt;/name-node&gt;</span><br><span class="line">            &lt;prepare&gt;</span><br><span class="line">               &lt;delete path=&quot;[PATH]&quot;/&gt;</span><br><span class="line">               ...</span><br><span class="line">               &lt;mkdir path=&quot;[PATH]&quot;/&gt;</span><br><span class="line">               ...</span><br><span class="line">            &lt;/prepare&gt;</span><br><span class="line">            &lt;job-xml&gt;[JOB-XML-FILE]&lt;/job-xml&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;property&gt;</span><br><span class="line">                    &lt;name&gt;[PROPERTY-NAME]&lt;/name&gt;</span><br><span class="line">                    &lt;value&gt;[PROPERTY-VALUE]&lt;/value&gt;</span><br><span class="line">                &lt;/property&gt;</span><br><span class="line">                ...</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">            &lt;script&gt;[PIG-SCRIPT]&lt;/script&gt;</span><br><span class="line">            &lt;param&gt;[PARAM-VALUE]&lt;/param&gt;</span><br><span class="line">                ...</span><br><span class="line">            &lt;param&gt;[PARAM-VALUE]&lt;/param&gt;</span><br><span class="line">            &lt;file&gt;[FILE-PATH]&lt;/file&gt;</span><br><span class="line">            ...</span><br><span class="line">            &lt;archive&gt;[FILE-PATH]&lt;/archive&gt;</span><br><span class="line">            ...</span><br><span class="line">        &lt;/pig&gt;</span><br><span class="line">        &lt;ok to=&quot;[NODE-NAME]&quot;/&gt;</span><br><span class="line">        &lt;error to=&quot;[NODE-NAME]&quot;/&gt;</span><br><span class="line">    &lt;/action&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/workflow-app&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Example(schema 0.1):</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"sample-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"myfirstpigjob"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pig</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"$&#123;jobOutput&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.compress.map.output<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">/mypigscript.pig</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span>&gt;</span>InputDir=/home/tucu/input-data<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span>&gt;</span>OutputDir=$&#123;jobOutput&#125;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pig</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"myotherjob"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"errorcleanup"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-5-Hive-Action"><a href="#2-2-5-Hive-Action" class="headerlink" title="2.2.5 Hive Action"></a>2.2.5 Hive Action</h3><p>Hive Action的配置基本与Pig Action一致</p>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hive</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:hive-action:0.2"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>[JOB-TRACKER]<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>[NAME-NODE]<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">               <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>[HIVE SETTINGS FILE]<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>[PROPERTY-NAME]<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>[PROPERTY-VALUE]<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">[HIVE-SCRIPT]</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span>&gt;</span>[PARAM-VALUE]<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span>&gt;</span>[PARAM-VALUE]<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">file</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">archive</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">hive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## job-xml：hive的一些配置信息，一般为 $HIVE_HOME/conf/hive-site.xml</span><br><span class="line">## script：hive的脚本文件</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<ul>
<li>作业目录：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- hive-site.xml</span><br><span class="line">- hive.q</span><br><span class="line">- workflow.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>workflow.xml 文件内容</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"workflow-app-hive"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.2"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">start</span> <span class="attr">to</span>=<span class="string">"hive"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hive"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">hive</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:hive-action:0.2"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>localhost:8032<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name-node</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>hive-site.xml<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.job.queue.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>default<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">hive.q</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span>&gt;</span>inpath=/users.txt<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">hive</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"end"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"kill"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">kill</span> <span class="attr">name</span>=<span class="string">"kill"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span>&gt;</span> Map/Reduce failed, error message[\$\&#123;wf:errorMessage(wf:lastErrorNode())&#125;] <span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">kill</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">end</span> <span class="attr">name</span>=<span class="string">"end"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>hive-site.xml 文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>Username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 密码自行修改 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>******<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>password to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.local.scratchdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/var/hive/iotmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>Local scratch space for Hive jobs<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.downloaded.resources.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/var/hive/$&#123;hive.session.id&#125;_resources<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>Temporary local directory for added resources in the remote file system.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.querylog.location<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/var/hive/iotemp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>Location of Hive run time structured log file<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.logging.operation.log.location<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/var/hive/$&#123;system:user.name&#125;/operation_logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>Top level directory where operation logs are stored if logging functionality is enabled<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>hive.q文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data inpath &apos;$&#123;inpath&#125;&apos; into table users;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意事项：<br>1、类似于sqoop，如果元数据是存储在mysql中，那么需要在oozie的sharelib的hive下导入驱动包。<br>2、一个坑：由于我的Oozie使用的是CDH版本，需要在导入一个Jar包( <code>hadoop-core-2.6.0-mr1-cdh5.7.0.jar</code> 这个包应该能在Oozie目录下找到，自行搜索一把)，否则报错找不到 <code>MRVersion</code> 的类（这个类比较坑，Apache的hadoop没有，CDH的版本才有）<br>3、运行实质是启动Hive的命令 <code>hive -e &quot;...&quot; -hivevar ...</code></p>
</blockquote>
<h3 id="2-2-6-Fs-HDFS-action"><a href="#2-2-6-Fs-HDFS-action" class="headerlink" title="2.2.6 Fs (HDFS) action"></a>2.2.6 Fs (HDFS) action</h3><p>Fs Action 可以通过 Workflow Application 操作 HDFS 中的文件和目录。支持的命令（节点）有 <code>move</code> , <code>delete</code> , <code>mkdir</code> , <code>chmod</code> , <code>touchz</code> and <code>chgrp</code> .</p>
<blockquote>
<p>Important：如果某个命令在运行中失败，之前运行成功的命令将 <code>不会回滚</code> 。</p>
</blockquote>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.5"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">'[PATH]'</span>/&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">'[PATH]'</span>/&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">move</span> <span class="attr">source</span>=<span class="string">'[SOURCE-PATH]'</span> <span class="attr">target</span>=<span class="string">'[TARGET-PATH]'</span>/&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">chmod</span> <span class="attr">path</span>=<span class="string">'[PATH]'</span> <span class="attr">permissions</span>=<span class="string">'[PERMISSIONS]'</span> <span class="attr">dir-files</span>=<span class="string">'false'</span> /&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">touchz</span> <span class="attr">path</span>=<span class="string">'[PATH]'</span> /&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">chgrp</span> <span class="attr">path</span>=<span class="string">'[PATH]'</span> <span class="attr">group</span>=<span class="string">'[GROUP]'</span> <span class="attr">dir-files</span>=<span class="string">'false'</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fs</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># delete：删除操作，如果是目录将递归删除，并最后删除目录。</span><br><span class="line"># mkdir：如果目录存在将什么也不做</span><br><span class="line"># move：移动操作</span><br><span class="line">	- source 必须存在</span><br><span class="line">	- target 的 PATH 中的父目录必须存在</span><br><span class="line">	- target PATH 如果是一个文件，那么目标文件不能存在（目录同理）</span><br><span class="line"># chmod：修改权限</span><br><span class="line">	- permissions 可以是 符号表示(-rwxrw-rw-)，或者数字表示(755)</span><br><span class="line">	- dir-files 如果是目录，是否影响目录下的文件权限</span><br><span class="line"># chgrp：修改所组</span><br><span class="line"># touchz：新建一个length为0的文件，如果文件存在执行touch操作</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"sample-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.5"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hdfscommands"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">fs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">'hdfs://foo:8020/usr/tucu/temp-data'</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">'archives/$&#123;wf:id()&#125;'</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">move</span> <span class="attr">source</span>=<span class="string">'$&#123;jobInput&#125;'</span> <span class="attr">target</span>=<span class="string">'archives/$&#123;wf:id()&#125;/processed-input'</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">chmod</span> <span class="attr">path</span>=<span class="string">'$&#123;jobOutput&#125;'</span> <span class="attr">permissions</span>=<span class="string">'-rwxrw-rw-'</span> <span class="attr">dir-files</span>=<span class="string">'true'</span>&gt;</span><span class="tag">&lt;<span class="name">recursive</span>/&gt;</span><span class="tag">&lt;/<span class="name">chmod</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">chgrp</span> <span class="attr">path</span>=<span class="string">'$&#123;jobOutput&#125;'</span> <span class="attr">group</span>=<span class="string">'testgroup'</span> <span class="attr">dir-files</span>=<span class="string">'true'</span>&gt;</span><span class="tag">&lt;<span class="name">recursive</span>/&gt;</span><span class="tag">&lt;/<span class="name">chgrp</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fs</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"myotherjob"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"errorcleanup"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>同时支持schema 0.4 中的 <code>name-node</code> 等节点。参考 <a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#GlobalConfigurations" title="Global Configurations" target="_blank" rel="noopener">Global Configurations</a></p>
</blockquote>
<h3 id="2-2-7-SSH-Action"><a href="#2-2-7-SSH-Action" class="headerlink" title="2.2.7 SSH Action"></a>2.2.7 SSH Action</h3><p>Ssh Action在远程机器上的后台运行一个 <code>secure shell</code></p>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ssh</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>[USER]@[HOST]<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">command</span>&gt;</span>[SHELL]<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>[ARGUMENTS]<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">capture-output</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ssh</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># capture-output：如果配置，表明Oozie可以捕获 SSH 命令的输出，输出必须是 Java Properties的格式且大小不能超过2KB。这些输出可以被 decision nodes 使用。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"sample-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"myssjob"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ssh</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>foo@bar.com<span class="tag">&lt;<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">command</span>&gt;</span>uploaddata<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>jdbc:derby://bar.com:1527/myDB<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>hdfs://foobar.com:8020/usr/tucu/myData<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ssh</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"myotherjob"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"errorcleanup"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-8-Sub-workflow-Action"><a href="#2-2-8-Sub-workflow-Action" class="headerlink" title="2.2.8 Sub-workflow Action"></a>2.2.8 Sub-workflow Action</h3><p>Sub-workflow Action 运行一个子流程，子流程job可以运行在其他的Oozie系统中。</p>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sub-workflow</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">app-path</span>&gt;</span>[WF-APPLICATION-PATH]<span class="tag">&lt;/<span class="name">app-path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">propagate-configuration</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>[PROPERTY-NAME]<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>[PROPERTY-VALUE]<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sub-workflow</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># propagate-configuration：如果配置表明 父流程 的配置将传播给 子流程</span><br><span class="line"># configuration：传播给 子流程 的配置</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子:</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"sample-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"a"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sub-workflow</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">app-path</span>&gt;</span>child-wf<span class="tag">&lt;/<span class="name">app-path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>input.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;wf:id()&#125;/second-mr-output<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sub-workflow</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"end"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"kill"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># child-wf ：HDFS上的app-path，将会被运行在当前所在的Oozie系统中（http://myhost:11000/oozie），指定的工作流程必须已经部署</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tips: </p>
</blockquote>
<ul>
<li>libs的继承<ul>
<li>在 oozie-site.xml 指定 <code>oozie.subworkflow.classpath.inheritance</code> （boolean）</li>
<li>在 job.properties 指定 <code>oozie.wf.subworkflow.classpath.inheritance</code> （boolean）</li>
<li>如果同时配置，后者优先前者。后者默认是 false</li>
</ul>
</li>
<li>子流程递归的深度<ul>
<li>在 oozie-site.xml 指定 <code>oozie.action.subworkflow.max.depth</code> （数字，默认50）</li>
</ul>
</li>
</ul>
<h3 id="2-2-9-Java-Action"><a href="#2-2-9-Java-Action" class="headerlink" title="2.2.9 Java Action"></a>2.2.9 Java Action</h3><ol>
<li>Java Action 执行一个 <code>main</code> 方法，在 Hadoop 集群中被当做一个 <code>Map-Reduce Job</code> with a single Mapper task。</li>
<li>需要配置 <code>job-tracker</code>, <code>name-node</code>, <code>main Java class</code>, <code>JVM options</code> and <code>arguments</code>.</li>
<li>Java Class 不能调用 <code>System.exit(int n)</code>，不然会当 <code>error</code> 处理.</li>
<li><p>如果是在一个安全认证的集群中运行，Java Class需要指定Hadoop 授权令牌。比如：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">// propagate delegation related props from launcher job to MR job</span></span><br><span class="line"><span class="keyword">if</span> (System.getenv(<span class="string">"HADOOP_TOKEN_FILE_LOCATION"</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">    	jobConf.set(<span class="string">"mapreduce.job.credentials.binary"</span>, System.getenv(<span class="string">"HADOOP_TOKEN_FILE_LOCATION"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>[JOB-TRACKER]<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>[NAME-NODE]<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">               <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>[JOB-XML]<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>[PROPERTY-NAME]<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>[PROPERTY-VALUE]<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">main-class</span>&gt;</span>[MAIN-CLASS]<span class="tag">&lt;/<span class="name">main-class</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">java-opts</span>&gt;</span>[JAVA-STARTUP-OPTS]<span class="tag">&lt;/<span class="name">java-opts</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">arg</span>&gt;</span>ARGUMENT<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">file</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">archive</span>&gt;</span>[FILE-PATH]<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">capture-output</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"sample-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"myfirstjavajob"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"$&#123;jobOutput&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.queue.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>default<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">main-class</span>&gt;</span>org.apache.oozie.MyFirstMainClass<span class="tag">&lt;/<span class="name">main-class</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">java-opts</span>&gt;</span>-Dblah<span class="tag">&lt;/<span class="name">java-opts</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">arg</span>&gt;</span>argument1<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">arg</span>&gt;</span>argument2<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"myotherjob"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"errorcleanup"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tips: 可以配置 <code>oozie.launcher.action.main.class</code> 来覆盖 Main Class，而避免重新部署流程。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.launcher.action.main.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.my.CustomMain<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-10-Email-Action"><a href="#2-2-10-Email-Action" class="headerlink" title="2.2.10 Email Action"></a>2.2.10 Email Action</h3><p>Oozie 允许使用 email 节点进行邮件的发送，但是在发送之前需要对smtp等相关信息进行配置，在 <code>oozie-site.xml</code> 中配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- email 设置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.email.smtp.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>smtp.163.com<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">       The host where the email action may find the SMTP server (localhost by default).</span><br><span class="line">   <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.email.smtp.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>25<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">       The port to connect to for the SMTP server (25 by default).</span><br><span class="line">   <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.email.from.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>chenjhhx@163.com<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">       The from address to be used for mailing all emails (oozie@localhost by default).</span><br><span class="line">   <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.email.smtp.auth<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">       Boolean property that toggles if authentication is to be done or not. (false by default). </span><br><span class="line">   <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.email.smtp.username<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>chenjhhx@163.com<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">       If authentication is enabled, the username to login as (empty by default).  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 可以用自己的账户进行测试 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.email.smtp.password<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>**********<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">       If authentication is enabled, the username's password (empty by default). </span><br><span class="line">   <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tips: 在使用之前需要确保你的邮箱 <code>smpt等相关服务</code> 是打开的。这个可以进入你邮箱的设置里面进行设置。</p>
</blockquote>
<blockquote>
<p>语法</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:email-action:0.2"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">to</span>&gt;</span>[COMMA-SEPARATED-TO-ADDRESSES]<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">cc</span>&gt;</span>[COMMA-SEPARATED-CC-ADDRESSES]<span class="tag">&lt;/<span class="name">cc</span>&gt;</span> <span class="comment">&lt;!-- cc is optional --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">subject</span>&gt;</span>[SUBJECT]<span class="tag">&lt;/<span class="name">subject</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">body</span>&gt;</span>[BODY]<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">content_type</span>&gt;</span>[CONTENT-TYPE]<span class="tag">&lt;/<span class="name">content_type</span>&gt;</span> <span class="comment">&lt;!-- content_type is optional --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line">## to：表示发送给谁，多个以逗号分隔</span><br><span class="line">## cc：表示抄送，与to同理</span><br><span class="line">## subject：主题</span><br><span class="line">## body：邮件内容</span><br><span class="line">## content_type：内容的ContentType, 如可以是 text/html;charset=UTF-8（注意如果不填，中文是乱码）</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"sample-wf"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.1"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"an-email"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:email-action:0.1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">to</span>&gt;</span>bob@initech.com,the.other.bob@initech.com<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">cc</span>&gt;</span>will@initech.com<span class="tag">&lt;/<span class="name">cc</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">subject</span>&gt;</span>Email notifications for $&#123;wf:id()&#125;<span class="tag">&lt;/<span class="name">subject</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">body</span>&gt;</span>The wf $&#123;wf:id()&#125; successfully completed.<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">content_type</span>&gt;</span>text/html;charset=UTF-8<span class="tag">&lt;/<span class="name">content_type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"myotherjob"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"errorcleanup"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-11-Spark-节点"><a href="#2-2-11-Spark-节点" class="headerlink" title="2.2.11 Spark 节点"></a>2.2.11 Spark 节点</h3><blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">"[WF-DEF-NAME]"</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:workflow:0.3"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"[NODE-NAME]"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spark</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:spark-action:0.1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>[JOB-TRACKER]<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>[NAME-NODE]<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">               <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">"[PATH]"</span>/&gt;</span></span><br><span class="line">               ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>[SPARK SETTINGS FILE]<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>[PROPERTY-NAME]<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>[PROPERTY-VALUE]<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">master</span>&gt;</span>[SPARK MASTER URL]<span class="tag">&lt;/<span class="name">master</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mode</span>&gt;</span>[SPARK MODE]<span class="tag">&lt;/<span class="name">mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>[SPARK JOB NAME]<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">class</span>&gt;</span>[SPARK MAIN CLASS]<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">jar</span>&gt;</span>[SPARK DEPENDENCIES JAR / PYTHON FILE]<span class="tag">&lt;/<span class="name">jar</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">spark-opts</span>&gt;</span>[SPARK-OPTIONS]<span class="tag">&lt;/<span class="name">spark-opts</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span>[ARG-VALUE]<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span>[ARG-VALUE]<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">spark</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">"[NODE-NAME]"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line">### master: 可以指定spark的master url：spark://host:port, mesos://host:port, yarn-cluster, yarn-master, or local</span><br><span class="line"></span><br><span class="line">### mode: 可以指定（client, cluster）。配合master参数一起使用，比如(master=yarn, mode=client 相当于master=yarn-client)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tips</p>
</blockquote>
<ul>
<li>一般spark可以来跑spark jar，指定class名称，选择jars，然后配置一些opts参数等等。如果spark是单机模式启动、可以指定为<code>local</code>或者<code>sparkMaster的url</code>。如果是 spark on yarn， 则需指定为 <code>yarn-cluster</code>。</li>
<li><code>spark on yarn</code>需要指定一些运行时的参数，可以通过 <code>spark-opts</code> 指定 <code>--conf ...</code> 或者在 <code>oozie-site.xml</code>指定spark的配置参数目录 <code>oozie.service.SparkConfigurationService.spark.configurations</code>。一般包括如下参数，<ul>
<li>spark.yarn.historyServer.address=<a href="http://SPH-HOST:18088" target="_blank" rel="noopener">http://SPH-HOST:18088</a></li>
<li>spark.eventLog.dir=hdfs://NN:8020/user/spark/applicationHistory</li>
<li>spark.eventLog.enabled=true</li>
</ul>
</li>
</ul>
<h4 id="2-2-12-spark执行python"><a href="#2-2-12-spark执行python" class="headerlink" title="2.2.12 spark执行python"></a>2.2.12 spark执行python</h4><p>除了指定执行的jar之外，spark节点还可以执行<code>Python</code>脚本。比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">spark</span> <span class="attr">xmlns</span>=<span class="string">"uri:oozie:spark-action:0.1"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>haier-test-namenode:8032<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name-node</span>&gt;</span>hdfs://haier-test-namenode:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">master</span>&gt;</span>yarn-cluster<span class="tag">&lt;/<span class="name">master</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mode</span>&gt;</span>cluster<span class="tag">&lt;/<span class="name">mode</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>pyspark<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span>&gt;</span>/tmp/spark-yarn.py<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">jar</span>&gt;</span>/tmp/spark-yarn.py<span class="tag">&lt;/<span class="name">jar</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">spark-opts</span>&gt;</span>--executor-memory 1G  --executor-cores 2<span class="tag">&lt;/<span class="name">spark-opts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">spark</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>不过这样执行可能会出现如下问题:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.util.NoSuchElementException: key not found: SPARK_HOME</span><br><span class="line">## https://issues.apache.org/jira/browse/OOZIE-2482</span><br><span class="line">## https://community.cloudera.com/t5/Batch-Processing-and-Workflow/quot-Failing-Oozie-Launcher-key-not-found-SPARK-HOME-quot/td-p/39830</span><br><span class="line"></span><br><span class="line">## 试了很多解决方案，有的没有用。。</span><br></pre></td></tr></table></figure>
<ul>
<li>解决方案：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## 在configuration中接入配置</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.launcher.yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>SPARK_HOME=/opt/cloudera/parcels/CDH/lib/spark/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">## 个人感觉有点挫。。。</span><br></pre></td></tr></table></figure>
<h1 id="3-流程定义中的参数化（EL-表达式）"><a href="#3-流程定义中的参数化（EL-表达式）" class="headerlink" title="3. 流程定义中的参数化（EL 表达式）"></a>3. 流程定义中的参数化（EL 表达式）</h1><h2 id="3-1-变量"><a href="#3-1-变量" class="headerlink" title="3.1 变量"></a>3.1 变量</h2><ol>
<li>参数变量的定义使用 JSP Expression Language，比如 <code>${NAME}</code>。</li>
<li>变量名遵循一般变量的定义规则，需符合正则：<code>[A-Za-z_][0-9A-Za-z_]*</code>。比如 <code>&quot;job.tracker&quot;</code> 就是错误的定义。</li>
<li>参数也可以通过 xml 内联的方式引入，如：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;workflow-app name=&apos;hello-wf&apos; xmlns=&quot;uri:oozie:workflow:0.4&quot;&gt;</span><br><span class="line">    &lt;parameters&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">            &lt;name&gt;inputDir&lt;/name&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">            &lt;name&gt;outputDir&lt;/name&gt;</span><br><span class="line">            &lt;value&gt;out-dir&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/parameters&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/workflow-app&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3-2-方法"><a href="#3-2-方法" class="headerlink" title="3.2 方法"></a>3.2 方法</h2><p>参考：</p>
<ol>
<li><a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2.1_Basic_EL_Constants" title="Basic EL Constants And Functions" target="_blank" rel="noopener">Basic EL Constants And Functions</a></li>
<li><a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2.3_Workflow_EL_Functions" title="Workflow EL Functions" target="_blank" rel="noopener">Workflow EL Functions</a></li>
<li><a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2.4_Hadoop_EL_Constants" title="Hadoop EL Constants And Functions" target="_blank" rel="noopener">Hadoop EL Constants And Functions</a></li>
<li><a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2.6_Hadoop_Jobs_EL_Function" title="Hadoop Jobs EL Function" target="_blank" rel="noopener">Hadoop Jobs EL Function</a></li>
<li><a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2.7_HDFS_EL_Functions" title="HDFS EL Functions" target="_blank" rel="noopener">HDFS EL Functions</a></li>
<li><a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2.8_HCatalog_EL_Functions" title="HCatalog EL Functions" target="_blank" rel="noopener">HCatalog EL Functions</a></li>
</ol>
<h1 id="4-工作流回调"><a href="#4-工作流回调" class="headerlink" title="4. 工作流回调"></a>4. 工作流回调</h1><p>在一个 <code>Workflow Job</code> 或者 <code>Action</code> 的开始和结束，都可以配置回调的 <code>HTTP GET</code> URL。</p>
<p>参考：<a href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a5_Workflow_Notifications" title="Workflow_Notifications" target="_blank" rel="noopener">Workflow_Notifications</a></p>
<h1 id="5-工作流程部署"><a href="#5-工作流程部署" class="headerlink" title="5. 工作流程部署"></a>5. 工作流程部署</h1><p>工作流程的应用需要上传到 HDFS 中，目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- /workflow.xml</span><br><span class="line">- /config-default.xml</span><br><span class="line">|</span><br><span class="line">- /lib/ (*.jar;*.so)</span><br></pre></td></tr></table></figure>
<p>一个工作流应用至少包含 <code>workflow.xml</code>。</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/oozie/">oozie</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/oozie/">oozie</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://www.patamon.me/icemimosa/oozie/Oozie-3_工作流程定义/" data-title="Oozie-3_工作流程定义 | Ice の Mimosa" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/icemimosa/oozie/Oozie-4_Coordinator定义/" title="Oozie-4_Coordinator定义">
  <strong>PREVIOUS:</strong><br>
  <span>
  Oozie-4_Coordinator定义</span>
</a>
</div>


<div class="next">
<a href="/icemimosa/oozie/Oozie-2_安装/" title="Oozie-2_安装">
 <strong>NEXT:</strong><br> 
 <span>Oozie-2_安装
</span>
</a>
</div>

</nav>

	


<!--PC和WAP自适应版-->
<div id="SOHUCS" class="comment"></div>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Oozie-3-工作流程定义"><span class="toc-text">Oozie-3_工作流程定义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-简介"><span class="toc-text">1. 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-流程定义"><span class="toc-text">2. 流程定义</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-控制节点"><span class="toc-text">2.1 控制节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-start-节点"><span class="toc-text">2.1.1 start 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-end-节点"><span class="toc-text">2.1.2 end 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-kill-节点"><span class="toc-text">2.1.3 kill 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-decision-节点"><span class="toc-text">2.1.4 decision 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-fork-和-join-节点"><span class="toc-text">2.1.5 fork 和 join 节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-动作节点"><span class="toc-text">2.2 动作节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-Action-Basics-基本特性"><span class="toc-text">2.2.1 Action Basics 基本特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-Map-Reduce-Action"><span class="toc-text">2.2.2 Map-Reduce Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-Pig-Action"><span class="toc-text">2.2.4 Pig Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-5-Hive-Action"><span class="toc-text">2.2.5 Hive Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-6-Fs-HDFS-action"><span class="toc-text">2.2.6 Fs (HDFS) action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-7-SSH-Action"><span class="toc-text">2.2.7 SSH Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-8-Sub-workflow-Action"><span class="toc-text">2.2.8 Sub-workflow Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-9-Java-Action"><span class="toc-text">2.2.9 Java Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-10-Email-Action"><span class="toc-text">2.2.10 Email Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-11-Spark-节点"><span class="toc-text">2.2.11 Spark 节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-12-spark执行python"><span class="toc-text">2.2.12 spark执行python</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-流程定义中的参数化（EL-表达式）"><span class="toc-text">3. 流程定义中的参数化（EL 表达式）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-变量"><span class="toc-text">3.1 变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-方法"><span class="toc-text">3.2 方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-工作流回调"><span class="toc-text">4. 工作流回调</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-工作流程部署"><span class="toc-text">5. 工作流程部署</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-logo"></div>		
	
	<div class="social-list">
		
		<a href="http://weibo.com/3699593035" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/IceMimosa" target="_blank" title="github"></a>
		
		
		
		
		<a href="mailto:514793425@qq.com" target="_blank" title="email"></a>
		
	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>2</sup></a></li>
		
			<li><a href="/categories/hadoop/" title="hadoop">hadoop<sup>2</sup></a></li>
		
			<li><a href="/categories/hbase/" title="hbase">hbase<sup>12</sup></a></li>
		
			<li><a href="/categories/hive/" title="hive">hive<sup>11</sup></a></li>
		
			<li><a href="/categories/java/" title="java">java<sup>26</sup></a></li>
		
			<li><a href="/categories/kotlin/" title="kotlin">kotlin<sup>1</sup></a></li>
		
			<li><a href="/categories/oozie/" title="oozie">oozie<sup>10</sup></a></li>
		
			<li><a href="/categories/pulsar/" title="pulsar">pulsar<sup>1</sup></a></li>
		
			<li><a href="/categories/redis/" title="redis">redis<sup>13</sup></a></li>
		
			<li><a href="/categories/spark/" title="spark">spark<sup>5</sup></a></li>
		
			<li><a href="/categories/springboot/" title="springboot">springboot<sup>2</sup></a></li>
		
			<li><a href="/categories/sqoop/" title="sqoop">sqoop<sup>3</sup></a></li>
		
			<li><a href="/categories/数仓/" title="数仓">数仓<sup>4</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>2</sup></a></li>
		
			<li><a href="/tags/hadoop/" title="hadoop">hadoop<sup>11</sup></a></li>
		
			<li><a href="/tags/hbase/" title="hbase">hbase<sup>12</sup></a></li>
		
			<li><a href="/tags/hive/" title="hive">hive<sup>11</sup></a></li>
		
			<li><a href="/tags/impala/" title="impala">impala<sup>1</sup></a></li>
		
			<li><a href="/tags/java/" title="java">java<sup>27</sup></a></li>
		
			<li><a href="/tags/kotlin/" title="kotlin">kotlin<sup>1</sup></a></li>
		
			<li><a href="/tags/lombok/" title="lombok">lombok<sup>3</sup></a></li>
		
			<li><a href="/tags/mac/" title="mac">mac<sup>2</sup></a></li>
		
			<li><a href="/tags/mysql/" title="mysql">mysql<sup>1</sup></a></li>
		
			<li><a href="/tags/olap/" title="olap">olap<sup>4</sup></a></li>
		
			<li><a href="/tags/oozie/" title="oozie">oozie<sup>10</sup></a></li>
		
			<li><a href="/tags/pulsar/" title="pulsar">pulsar<sup>1</sup></a></li>
		
			<li><a href="/tags/react/" title="react">react<sup>1</sup></a></li>
		
			<li><a href="/tags/redis/" title="redis">redis<sup>13</sup></a></li>
		
			<li><a href="/tags/spark/" title="spark">spark<sup>5</sup></a></li>
		
			<li><a href="/tags/spring/" title="spring">spring<sup>2</sup></a></li>
		
			<li><a href="/tags/springboot/" title="springboot">springboot<sup>2</sup></a></li>
		
			<li><a href="/tags/sqoop/" title="sqoop">sqoop<sup>4</sup></a></li>
		
			<li><a href="/tags/数仓/" title="数仓">数仓<sup>4</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/JavaScript/" style="font-size: 11px;">JavaScript</a> <a href="/tags/hadoop/" style="font-size: 16px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 17px;">hbase</a> <a href="/tags/hive/" style="font-size: 16px;">hive</a> <a href="/tags/impala/" style="font-size: 10px;">impala</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/kotlin/" style="font-size: 10px;">kotlin</a> <a href="/tags/lombok/" style="font-size: 12px;">lombok</a> <a href="/tags/mac/" style="font-size: 11px;">mac</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/olap/" style="font-size: 13px;">olap</a> <a href="/tags/oozie/" style="font-size: 15px;">oozie</a> <a href="/tags/pulsar/" style="font-size: 10px;">pulsar</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/redis/" style="font-size: 18px;">redis</a> <a href="/tags/spark/" style="font-size: 14px;">spark</a> <a href="/tags/spring/" style="font-size: 11px;">spring</a> <a href="/tags/springboot/" style="font-size: 11px;">springboot</a> <a href="/tags/sqoop/" style="font-size: 13px;">sqoop</a> <a href="/tags/数仓/" style="font-size: 13px;">数仓</a> <a href="/tags/源码/" style="font-size: 19px;">源码</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer">
    
            <p class="copyright"> © 2023 
		
		<a href="http://www.patamon.me" target="_blank" title="IceMimosa">IceMimosa</a>
		
            <!-- && Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> && Theme by <a href="http://gengbiao.me" target="_blank" title="coney">coney</a> -->
            ❖ Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a>
            </p></div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script src="/js/jquery-icemi-scroll2top.js"></script>
<script src="/js/other.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  
  // 回到顶部
  $(document.body).scroll2Top({
    background:"#66ccff",
    shape:"circle",
    bottom:40,
    right:250
  });

  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    // m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,332-$(this).scrollTop()));
  });
});
</script>

<!-- GrowingIO Analytics code version 2.1 -->
<!-- Copyright 2015-2018 GrowingIO, Inc. More info available at http://www.growingio.com -->
<script type="text/javascript">
!function(e,t,n,g,i){e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=('https:'==document.location.protocol?'https://':'http://')+g,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.growingio.com/2.1/gio.js","gio");
gio('init','b988cbf13dfaa5ac', {});
//custom page code begin here

//custom page code end here
gio('send');
</script>
<!-- End GrowingIO Analytics code version: 2.1 -->


<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    // t.css('display','none');
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    $(window).scroll(function(){
      ta.css("top", Math.max(140,380-$(this).scrollTop()));
      ta.css("right", 65);
    });
    o.click(function(){
      ta.css('display', 'none');
    });
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top", Math.max(140,380-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>




<script type="text/javascript"> 
  (function(){ 
    var appid = "cyt6xqnNX";
    var conf = 'prod_97c2bd32b8416b2df1809e56a3f6d431'; 
    var width = window.innerWidth || document.documentElement.clientWidth; 
    if (width < 960) { 
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); 
    } else { 
      var loadJs = function(d,a) {
        var c = document.getElementsByTagName("head")[0]||document.head||document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type","text/javascript");
        b.setAttribute("charset","UTF-8");
        b.setAttribute("src",d);
        if(typeof a==="function") {
          if(window.attachEvent) {
            b.onreadystatechange = function() {
              var e = b.readyState;
              if(e==="loaded"||e==="complete") {
                b.onreadystatechange=null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)};
        loadJs("https://changyan.sohu.com/upload/changyan.js",
          function() {
            window.changyan.api.config({
              appid: appid, 
              conf: conf
            })
          }
        ); 
      } 
    })();
</script> 






<script>
    
        var _bdImg = '4';
    
    window._bd_share_config={
        "common":{
            "bdSnsKey":{

            },
            "bdText":"",
            "bdMini":"2",
            "bdMiniList":[
                "qzone",
                "tsina",
                "weixin",
                "renren",
                "tqq",
                "tieba",
                "douban",
                "sqq",
                "diandian",
                "huaban",
                "youdao",
                "mail",
                "ty",
                "fbook",
                "twi",
                "linkedin",
                "copy",
                "print"
            ],
            "bdPic":"",
            "bdStyle":"0",
            "bdSize":"16"
        },
        "slide":{
            "type":"slide",
            "bdImg":_bdImg,
            "bdPos":"right",
            "bdTop":"350"
        },
        "image":{
            "viewList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ],
            "viewText":"分享：",
            "viewSize":"16"
        },
        "selectShare":{
            "bdContainerClass":null,
            "bdSelectMiniList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ]
        }
    };
    with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>




<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>


  <script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":100,"height":200,"hOffset":240,"vOffset":-45},"mobile":{"show":false},"log":false,"tagMode":false});</script></body>
</html>

